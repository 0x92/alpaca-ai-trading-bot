{% extends 'base.html' %}

{% block content %}
<h1 class="text-2xl font-bold mb-4">Portfolios</h1>
<form method="post" action="{{ url_for('step') }}" class="mb-4">
    <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Step</button>
</form>
<div class="space-y-4">
    {% for p in portfolios %}
    <div id="portfolio-{{ p.name }}" class="bg-white shadow p-4 rounded">
        <h2 class="text-xl font-semibold">{{ p.name }}</h2>
        <form method="post" action="{{ url_for('set_strategy', name=p.name) }}" class="my-2">
            <label class="text-sm">Strategy:
                <select name="strategy_type" onchange="this.form.submit()" class="border rounded px-1 py-0">
                    {% for s in ['default', 'momentum', 'mean_reversion'] %}
                    <option value="{{ s }}" {% if p.strategy_type == s %}selected{% endif %}>{{ s }}</option>
                    {% endfor %}
                </select>
            </label>
        </form>
        <p>Cash: <span class="cash">{{ p.cash }}</span></p>
        <p>Portfolio value: <span class="portfolio_value">{{ p.portfolio_value }}</span></p>
        <div class="h-48">
            <canvas id="chart-{{ p.name }}"></canvas>
        </div>
        <h3 class="font-semibold mt-2">Trades</h3>
        <ul class="list-disc list-inside history">
            {% for trade in p.history %}
            <li>{{ trade.get('symbol') }} {{ trade.get('side') }} {{ trade.get('qty') }} @ {{ trade.get('submitted_at') }}</li>
            {% else %}
            <li>No trades yet.</li>
            {% endfor %}
        </ul>
    </div>
    {% endfor %}
</div>
<script id="initial-data" type="application/json">{{ portfolios | tojson }}</script>
{% endblock %}
