<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Trading Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body class="bg-gray-100 p-4">
    {% block content %}{% endblock %}
    <script>
        const socket = io();
        function updatePortfolios(data) {
            if (!Array.isArray(data)) return;
            data.forEach(p => {
                const el = document.getElementById('portfolio-' + p.name);
                if (!el) return;
                el.querySelector('.cash').textContent = p.cash;
                el.querySelector('.portfolio_value').textContent = p.portfolio_value;
                const historyList = el.querySelector('.history');
                historyList.innerHTML = '';
                if (p.history.length === 0) {
                    historyList.innerHTML = '<li>No trades yet.</li>';
                } else {
                    p.history.forEach(t => {
                        const item = document.createElement('li');
                        item.textContent = `${t.symbol} ${t.side} ${t.qty} @ ${t.submitted_at}`;
                        historyList.appendChild(item);
                    });
                }
            });
        }
        socket.on('trade_update', updatePortfolios);
    </script>
</body>
</html>
